# -*- coding: utf-8 -*-
"""zero_shot_evaluation

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1vRDl9sJRLM2BKk2_2B62dUuo45eIpj0j
"""

# Install transformers if not already installed
!pip install -q transformers

# Import libraries
from transformers import pipeline
import pandas as pd
from tqdm import tqdm

# Load test data
test_df = pd.read_csv("test.csv")

# Initialize zero-shot classification pipeline
classifier = pipeline("zero-shot-classification", model="facebook/bart-large-mnli")

# Define the candidate sentiment labels
candidate_labels = ["positive", "negative"]

# Run zero-shot classification on each review in the test set
predictions = []
true_labels = []

print("Running zero-shot sentiment classification...")

for _, row in tqdm(test_df.iterrows(), total=len(test_df)):
    review_text = row['review_text']
    true_label = row['label']  # 1 for positive, 0 for negative

    result = classifier(review_text, candidate_labels)
    predicted_label = result['labels'][0]  # Highest confidence label

    # Convert string label back to binary
    predicted_binary = 1 if predicted_label == 'positive' else 0

    predictions.append(predicted_binary)
    true_labels.append(true_label)

# Evaluate accuracy
from sklearn.metrics import accuracy_score, classification_report

accuracy = accuracy_score(true_labels, predictions)
report = classification_report(true_labels, predictions, target_names=["Negative", "Positive"])

print(f"\nðŸ“Š Zero-Shot Sentiment Classification Accuracy: {accuracy:.4f}")
print("\nClassification Report:")
print(report)